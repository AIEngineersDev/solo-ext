(()=>{const e={port:null,selectedText:"",pageText:""};function t(){const t=window.getSelection().toString().trim();let n="";return t?(e.selectedText=t,n=t):(n=Array.from(document.body.getElementsByTagName("*")).filter((e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&!e.hidden})).map((e=>Array.from(e.childNodes).filter((e=>e.nodeType===Node.TEXT_NODE)).map((e=>e.textContent.trim())).join(" "))).filter((e=>e.length>0)).join("\n").replace(/[\s\n]+/g," ").trim(),e.pageText=n),n.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g,"").replace(/[^\w\s.,!?-]/g," ").trim()}chrome.runtime.onMessage.addListener(((n,r,o)=>{if("getContent"===n.action)return function(){if(!e.port||e.port.disconnected)try{e.port=chrome.runtime.connect({name:"content-script"}),e.port.onDisconnect.addListener((()=>{e.port.disconnected=!0}))}catch(e){console.error("Connection error:",e)}}(),o({content:t()}),!0}))})();